<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Memory and Caching</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="9fb4574b-dbd0-4e30-87cb-590f646190a8" class="page sans"><header><h1 class="page-title">Memory and Caching</h1></header><div class="page-body"><p id="70e91028-1980-4aea-8909-7d666c06783a" class="">
</p><nav id="8e493bc1-9499-4871-9967-bbc469549dde" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#169cd266-16e8-440a-9716-85238458eee0">Definition</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#276457fe-91f8-43b4-8036-11fa209faab4">Shared-memory model</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d6179e49-034b-4652-a963-0f5728a034e2">Cache</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1a68a05a-30f2-48be-8891-c467348ab7c4">Cache read/write-miss</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#dd325803-d0a7-442b-a889-a2430612a232">Cache impact on performance</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#4b8639f5-b6f2-466e-8050-e2f8f5e3371a">Example: Matrix-Matrix multiplication</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#ec5531b5-9214-4377-8e54-68e5d9b58d35">Recursive solution</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#23ae94b7-2646-4e77-b3db-a38da8fadca0">Cache coherence</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#a10da41d-3025-47ae-9be8-b631806d86db">False sharing</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#5af19b64-5c56-477d-b6dc-6da18675de9c">NUMA memory performance</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f6d6d04c-8a90-4d24-97dd-889db14ea01a">Super-linear speedup</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#bca2a9e3-f963-42d4-8ee1-f51140dfbb6a">Application performance and memory system</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#6b55598f-c0b9-4067-b327-b527372a7195">Program order and memory consistency</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#246cc8cd-bc79-421b-94f8-8ec6814f601f">Consistency models</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d769c9e3-6ea6-40d4-9e68-c9816ec07803">Programming models for memory</a></div></nav><p id="896ddc20-ef40-446e-b270-28e6e77cffba" class="">
</p><h1 id="169cd266-16e8-440a-9716-85238458eee0" class="">Definition</h1><p id="28e6e242-9eee-462b-90b4-c94fe207b496" class=""><mark class="highlight-blue">Modern terminology</mark><div class="indented"><p id="733879b1-3a97-410c-99ce-54cc5952ea7b" class=""><mark class="highlight-teal">Core</mark><div class="indented"><p id="14d6a459-d12d-4661-973c-381f372d7a43" class="">CPU / Processing element PE (also still sometimes called processor)</p></div></p><p id="e727849a-f614-44c4-8259-9fc7dc3f6014" class=""><mark class="highlight-teal">Processor</mark><div class="indented"><p id="16c96809-ed8f-4221-be8c-e0aee6a7142d" class="">several cores that can execute a program</p><ul id="5f0b9083-49e3-4f1c-846d-f4ac7612f0cd" class="bulleted-list"><li style="list-style-type:disc"><em>Multi-core processor</em><p id="cdf848a5-88ba-4abb-b806-4f12cd7f190e" class="">Processor with several cores physically on the same chip. Always shared-memory (typically caches).</p></li></ul><ul id="eaaa3e13-2ac4-46d2-ace4-9b82620c1f43" class="bulleted-list"><li style="list-style-type:disc"><em>Many-core processor</em><p id="870535d6-618e-471d-b6b1-43750162821b" class="">Usually the GPU is meant.</p></li></ul></div></p><p id="b3ad5143-da88-42fd-9d6e-fa7b5c749212" class=""><mark class="highlight-teal">Multi-processor system</mark><div class="indented"><p id="2e5b9205-8980-4470-a594-8f5a8504b88c" class="">System with several processors, not necessarily on the same chip.</p><p id="ef62109d-1a8b-47aa-98cc-f5fe62ac9f92" class="">The processors can be multi-core and can have shared-memory or shared caches.</p></div></p></div></p><figure id="54b003ef-b3d3-46fa-a1d3-c73b93a3defc" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled.png"><img style="width:240px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled.png"/></a></figure><p id="41f820d7-0450-4fc9-abf7-03cf528467d8" class="">
</p><p id="bdce1603-f551-44f0-914f-753a97f3b303" class=""><mark class="highlight-blue">Programming model concepts</mark><div class="indented"><p id="b81ec0f6-a410-410c-8176-7b6e094343e9" class="">Thread, process		program under execution</p><p id="71026f06-5389-49a7-9447-02c09fbfb03a" class="">Task					some piece of work to be executed by a process or thread</p></div></p><p id="c5877e5a-52e5-4e94-9f5d-5448ae1d7b48" class="">
</p><p id="40156b0d-f6e8-4d92-ae41-a2d85edf9517" class="">
</p><h1 id="276457fe-91f8-43b4-8036-11fa209faab4" class="">Shared-memory model</h1><p id="a33f3282-3cb2-4fdb-9dc6-0d2c76ec6939" class="">Shared memory models for architectures and machines</p><p id="69bad492-6432-4b78-9022-86d7ec873bcc" class="">
</p><p id="c5a8eddb-3f0c-4e36-a485-2fa28d780300" class=""><mark class="highlight-blue">Naive shared memory model</mark><div class="indented"><p id="995b8581-ef33-44a2-8232-841b56dbacc1" class="">Processors connected directly to memory (as in UMA or NUMA)</p><p id="3362b422-d69e-4404-b45e-2d04bc61b3e0" class="">Read/write operations done independently (not PRAM, not lock-step, not synchronized)</p><p id="c15b2251-4905-480d-b118-30463518a1c4" class=""><em>Implicit assumption:</em><div class="indented"><ul id="6ff40f73-9027-46da-a85c-423c9f5f4e13" class="bulleted-list"><li style="list-style-type:disc">Outcome is an <em>interleaving</em> of the instructions.</li></ul><ul id="eb2b81ea-5efe-4768-9dc7-44d208749a83" class="bulleted-list"><li style="list-style-type:disc">Memory is <em>consistent </em>as defined by program order (read and write order).</li></ul></div></p></div></p><p id="4b8ee3e7-3836-43bc-aebd-601a6b235375" class=""><mark class="highlight-blue">Naive shared programming model</mark><div class="indented"><ol type="1" id="ea6683a6-9b78-43a3-8e2b-89b10081e90f" class="numbered-list" start="1"><li><mark class="highlight-teal">Processors execute processes/threads inside each process.</mark><p id="7fef91fd-d36a-4702-9188-b7778a3371b3" class="">Model does not specify which processor (core) executes it and there may be more threads than processors (oversubscription).<div class="indented"><p id="c14b0633-a243-46d7-bb4b-28502ba5c80a" class=""><em>Symmetric multiprocessing SMP		</em>OS binds thread to core.</p><p id="57c5932e-3f57-424b-beaa-a63104749118" class=""><em>Improved performance by pinnning		</em>Explicitly binding thread to core.</p><p id="cdfa1015-64a3-4ab9-99ca-e2c98a608579" class=""><mark class="highlight-gray">								ie. for utilization of private caches</mark></p><p id="e57dc943-d638-46e3-9d05-3f20091eb31f" class=""><em>Parallel computing (dedicated system)	</em>Num. of cores = threads and some pinning.</p></div></p></li></ol><ol type="1" id="f5c1261f-1f8f-478f-a3b7-96a563d44dab" class="numbered-list" start="2"><li><mark class="highlight-teal">Processes/threads are not synchronized.</mark></li></ol><ol type="1" id="74502d30-5f43-43be-a8bb-9883f33e881b" class="numbered-list" start="3"><li><mark class="highlight-teal">Processes/threads exchange data through shared memory.</mark></li></ol><ol type="1" id="89a43265-88d8-4d84-b02a-7ae088af2e72" class="numbered-list" start="4"><li><mark class="highlight-teal">NUMA but entire memory is directly visible.</mark></li></ol></div></p><figure id="c6f29bac-27eb-4f61-a331-376471d57e38" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%201.png"><img style="width:240px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%201.png"/></a></figure><p id="41cd8fad-c74a-4278-94a3-df641e4513aa" class="">
</p><h2 id="d6179e49-034b-4652-a963-0f5728a034e2" class="">Cache</h2><p id="d51aff67-5975-4253-8ba6-04e746e9c67f" class=""><mark class="highlight-blue">“Real” shared memory architecture</mark><div class="indented"><p id="af9e7a48-c083-49c7-96a8-01c640879f58" class="">Cache (small and fast memory close to processor) and memory systems reduce memory bottleneck.</p><p id="77007209-3ac3-4401-98a3-5eea66ed683e" class="">Modern processors use several different caches with different purposes and different levels.<div class="indented"><p id="46b7db04-f8df-4852-9b8e-00d93a422840" class="">Main memory		GB space, &gt;100 cycles per access</p><p id="8f62a7e0-e830-42d8-9476-0756f4640a56" class=""><strong><mark class="highlight-teal">Cache</mark></strong><mark class="highlight-teal">			</mark>Kb to MB space, 1-20 cycles per access</p><p id="9aeea20c-6a34-4797-bce2-0df8d83e4090" class="">Register			≤64 bit, 0-1 cycles</p></div></p></div></p><div id="0e158d92-bad9-425b-8d5d-0f1eec50add9" class="column-list"><div id="27bc0a70-b3e1-4973-a23f-70d08c0529f2" style="width:25%" class="column"><figure id="d3bd98ac-fcde-438f-8964-933631524abb" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%202.png"><img style="width:48px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%202.png"/></a></figure></div><div id="b350de43-2c77-49da-855f-7fd254c59e51" style="width:25%" class="column"><figure id="45c44223-f4ba-41ce-a366-5b80ec1ad751" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%203.png"><img style="width:96px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%203.png"/></a></figure></div><div id="770103d9-d1b5-4e9e-aef9-13390600cf4b" style="width:25%" class="column"><figure id="b6335455-c4e2-41fc-802d-b86d4147cf51" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%204.png"><img style="width:96px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%204.png"/></a></figure></div><div id="4c4fcf31-6d62-4d82-97a0-b239fb1411b7" style="width:25%" class="column"><figure id="f669cefe-abf3-46fd-a0f8-d0dd3f977d49" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%205.png"><img style="width:96px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%205.png"/></a></figure></div></div><p id="4f720edc-b3b4-4a94-8174-89afe5b7a65c" class="">
</p><p id="5ee71c05-4899-4bb1-8fb4-e0a55eb1c5d3" class=""><mark class="highlight-blue">Cache as a problematic abstraction (illusion)</mark><div class="indented"><p id="1cacbf61-ca2f-4770-a072-ae5932e9fbb8" class="">In single processor architectures the cache contributes towards sustaining the RAM abstraction and is successful but in parallel processor architectures the abstraction becomes problematic:</p><p id="46cadb3f-ce95-45c8-aa05-b703eb88feaf" class=""><mark class="highlight-teal"><em>Cache coherency problem</em></mark><em>		</em>synchronizing caches: local copy of one cache gets updated</p><p id="6a77e0df-09ae-4846-b42c-22ab86d69117" class=""><mark class="highlight-teal"><em>Memory consistency problem</em></mark><em>		</em>different views in threads of what should be the same data</p></div></p><p id="03d90405-5152-48ea-95ca-3abf26921353" class="">
</p><p id="c767af30-027d-4f10-aa90-43a94440267e" class=""><mark class="highlight-blue">Cache Granularity</mark><div class="indented"><p id="c62068d4-f9b0-4ab3-beca-915adbea735f" class="">Cache consists of <em>cache-lines/blocks </em>of memory, used when reading/writing from main-memory.</p><p id="9b64ffd4-c330-48d1-a30b-0fd0e76137c7" class="">Typical size: 64Bytes (8 doubles, 16 ints)</p></div></p><p id="10d5cd17-8699-437c-80e8-8debd76c84e5" class="">
</p><p id="03d2e2fd-f19f-4ba1-9824-65d96b154621" class=""><mark class="highlight-blue">Locality</mark><div class="indented"><p id="8bd0311c-df4a-492a-aa31-b0d67d039427" class="">Caches make sense because of the following algorithm-properties:<div class="indented"><p id="0bdd67ed-d5dc-4e8d-abf3-6fe907f23120" class=""><em>temporal locality</em>		locations in memory used are used several times in succession</p><p id="99f90bd1-d19d-48b4-a6e3-04aee96a4d55" class=""><mark class="highlight-gray">					ie. when using the same operand (address) </mark></p><p id="bbaaeea4-95d0-4bf1-9523-a6c39a20d55f" class=""><em>spacial locality</em>			locations in memory used are close to eachother </p><p id="242c229e-2168-40f5-ae83-04ec883e7515" class=""><mark class="highlight-gray">					ie. when using different indices of an array</mark></p></div></p></div></p><p id="a520bf3b-662f-484f-8b7a-337eda2e65e8" class="">
</p><p id="34a986c1-3e90-468e-bbab-6176ef0b3705" class=""><mark class="highlight-blue">Multiprocessor/multi-core caches</mark><div class="indented"><p id="fe80867c-072d-4e61-a1fb-e21806540fcc" class="">Shared memory, cache coherent NUMA (ccNUMA) through memory network.</p><p id="478c970d-ada6-4d83-b7c9-fcb166d7a0bb" class="">Several cores share caches at different levels.</p></div></p><figure id="69addbad-db67-456f-8426-fc32e008606e" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%206.png"><img style="width:132px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%206.png"/></a></figure><p id="cee3423d-bd99-4658-aa45-4069720a0275" class="">
</p><p id="11c28768-9f37-412b-8338-92531587f734" class=""><mark class="highlight-blue">Mapping data from memory to cache</mark><div class="indented"><p id="63a5a898-3444-4ec5-aca5-464e51419e9d" class="">Assume data <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"></mstyle></mrow><annotation encoding="application/x-tex">\small </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"></span></span></span><span>﻿</span></span>occupies as much space as a block or less.</p><ul id="40be2baa-41e3-4739-9548-b3aa06d03a0a" class="bulleted-list"><li style="list-style-type:disc"><em>fully associative		</em>data can be stored in any cache-line</li></ul><ul id="0a972929-4199-4481-ada6-d95418fc84b4" class="bulleted-list"><li style="list-style-type:disc"><em>set associative			</em>data can be stored in a small set of cache-lines<ul id="9f3dc1ef-57f6-4574-8d45-bfbb387dd2f4" class="toggle"><li><details open=""><summary>in depth</summary><p id="d8e7d740-b8d1-4c93-8ffd-71e3de7d8c60" class="">Memory: 	<mark class="highlight-gray"><code>M[0, ..., n-1]</code></mark></p><p id="8e912a16-d090-4d3b-8b5e-5c3a9d6e21b6" class="">Cache: 	<mark class="highlight-gray"><code>Lines [0, ..., m-1]</code></mark><div class="indented"><p id="b3606453-73be-41a6-92e8-7456851504c1" class="">where <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>m</mi><mo>≪</mo><mi>n</mi></mstyle></mrow><annotation encoding="application/x-tex">\small m \ll n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5203800000000001em;vertical-align:-0.035190000000000006em;"></span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">≪</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.387504em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">n</span></span></span></span></span><span>﻿</span></span> and block size <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>s</mi></mstyle></mrow><annotation encoding="application/x-tex">\small s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.387504em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">s</span></span></span></span></span><span>﻿</span></span>.</p></div></p><hr id="38d02993-9210-41ca-a7c5-299036da7dc6"/><p id="fdc61b67-c878-4fc9-be05-1dd4df67fdb2" class="">k-way set associative means that the cache lines are grouped in <mark class="highlight-gray"><code>m/k</code></mark><mark class="highlight-gray"> </mark>sets — each set with <mark class="highlight-gray"><code>k</code></mark><mark class="highlight-gray"> </mark>cache-lines.</p><p id="7cbe7c0b-4c5e-4946-bb3c-7e22e58efbad" class=""><mark class="highlight-gray"><code>M[i]</code></mark><mark class="highlight-gray"> </mark>is cached in set <mark class="highlight-gray"><code>(i/s) mod (m/k)</code></mark></p><hr id="174b60e9-02da-4140-be40-6c3a3dca201b"/><p id="9ea56939-7120-46f6-b832-9dc438d7fc8c" class="">Usually <mark class="highlight-gray"><code>m=2^r</code></mark><mark class="highlight-gray"> </mark>and <mark class="highlight-gray"><code>s=2^r&#x27;</code></mark><mark class="highlight-gray"> </mark>for some <mark class="highlight-gray"><code>r,r&#x27;&gt;0</code></mark></p><p id="4b948c8f-7865-441f-83ef-5b1cc2551a7d" class="">Mod and div then can be translated into mask and shift.</p><p id="4ff907c0-9024-445e-ac34-6b55c0077946" class="">
</p></details></li></ul></li></ul><ul id="fa7427a4-52c8-4647-956f-3cfcabf50aea" class="bulleted-list"><li style="list-style-type:disc"><em>directly mapped		</em>data can be stored in only one specific cache-line<ul id="14f2f634-08ec-4fde-b856-bf9a1f0daa3b" class="toggle"><li><details open=""><summary>in depth</summary><p id="3af6a529-5420-4a39-9517-e2686fb5f79d" class="">Memory: 	<mark class="highlight-gray"><code>M[0, ..., n-1]</code></mark></p><p id="f7986145-4e17-42bd-9e5e-d13ec42fa33a" class="">Cache: 	<mark class="highlight-gray"><code>Lines [0, ..., m-1]</code></mark><div class="indented"><p id="5b8ad3a3-1850-4a72-85f4-8e20680589df" class="">where <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>m</mi><mo>≪</mo><mi>n</mi></mstyle></mrow><annotation encoding="application/x-tex">\small m \ll n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5203800000000001em;vertical-align:-0.035190000000000006em;"></span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">≪</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.387504em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">n</span></span></span></span></span><span>﻿</span></span> and block size <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>s</mi></mstyle></mrow><annotation encoding="application/x-tex">\small s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.387504em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">s</span></span></span></span></span><span>﻿</span></span>.</p></div></p><hr id="228791ae-0a8c-4774-9a0a-0936b34bceba"/><p id="49a60d9d-0765-4af4-ae5e-06a5a33ecfa6" class=""><mark class="highlight-gray"><code>M[i]</code></mark><mark class="highlight-gray"> </mark>is cached in line <mark class="highlight-gray"><code>(i/s) mod m</code></mark><div class="indented"><p id="6fc23d1f-ef72-493f-9b15-2269027c67ee" class=""><mark class="highlight-gray"><code>M[0],…,M[s-1]</code></mark><mark class="highlight-gray"> </mark>go to line 0</p><p id="d67a3465-66e4-465f-b09e-517a09385eff" class=""><mark class="highlight-gray"><code>M[s],…,M[2s-1]</code></mark><mark class="highlight-gray"> </mark>to line 1<div class="indented"><p id="95883f3a-bc42-4259-bae5-96b7457c473d" class="">…</p></div></p><p id="9c92ee96-bbd8-42e4-9089-656b35ef0ffb" class=""><mark class="highlight-gray"><code>M[m],…,M[m+s-1]</code></mark> again to line 0<div class="indented"><p id="e552bd88-4948-4afb-8f5a-ffde33c89b66" class="">…</p></div></p></div></p><hr id="fbca9d1b-91fc-484d-b001-b35e9ed1a19d"/><p id="a68266b0-5abf-4864-854d-7973dbc63378" class="">Usually <mark class="highlight-gray"><code>m=2^r</code></mark><mark class="highlight-gray"> </mark>and <mark class="highlight-gray"><code>s=2^r&#x27;</code></mark><mark class="highlight-gray"> </mark>for some <mark class="highlight-gray"><code>r,r&#x27;&gt;0</code></mark></p><p id="6971cb3c-ae3e-4d35-86c0-5ad18f959b71" class="">Mod and div then can be translated into mask and shift.</p><p id="21414ac9-7d81-4bb1-af00-ea13a5e9ec25" class="">
</p></details></li></ul></li></ul></div></p><p id="de7599f8-94da-496c-8388-eb36b9bcd305" class="">
</p><h2 id="1a68a05a-30f2-48be-8891-c467348ab7c4" class="">Cache read/write-miss</h2><p id="41cb7e94-acd4-4d8e-b7d8-8fe3b46801ee" class="">A “cache-hit” is when the address is already in the cache and ready to be read. </p><p id="e1615881-2d71-4557-979f-10a8612c9454" class="">
</p><p id="2c77a96d-430f-4d18-9b4e-196e5bbff7b3" class=""><mark class="highlight-blue">Cache reading</mark><div class="indented"><p id="b523257e-3004-4b18-997c-3b9ac5c79fb6" class="">Cache hit 			Read from cache</p><p id="7c48ba4e-52d4-42ff-aa6c-d7d048f8179b" class="">Read cache-miss 		Load block from memory into cache and read from cache</p></div></p><p id="88ccc9a7-5c9b-4bfd-92bc-281b5a9b7393" class="">
</p><p id="1ea536bb-9dfa-4e44-b063-da6a6bd071a1" class=""><mark class="highlight-blue">Cache writing</mark><div class="indented"><p id="1f54a15a-5ac4-439a-80de-44c020b4b461" class="">Cache hit 			Overwrite cache (and memory or wait until block is evicted)<div class="indented"><p id="83ea513b-5f6d-42fc-902b-0c3ca1372c71" class=""><mark class="highlight-teal">a) Write-back cache</mark><div class="indented"><p id="f7241b33-2a3c-4c72-bc9f-520995ba4800" class=""><mark class="highlight-gray">(typically also write-allocate)</mark></p><p id="18a3ff9a-bb80-4d42-8387-501234f450ed" class="">block is passed to memory, when it’s being evicted from cache </p></div></p><p id="c323ef87-998a-4e09-a427-b6361a3d8d53" class=""><mark class="highlight-teal">b) Write-through cache</mark><div class="indented"><p id="9d14ed30-a3d3-4e80-a10c-b406a0a6a499" class=""><mark class="highlight-gray">(typically also write-non-allocate)</mark></p><p id="1bc420ef-9be9-4f7c-86eb-4b9d17403197" class="">each write to cache is immediately passed to memory</p></div></p></div></p><hr id="dc88a41e-7398-4d8b-89a0-9dad0c0eee34"/><p id="9242bcbe-2341-4ebc-b5af-4ffabbfde3f0" class="">Write cache-miss		Loading block from memory is optional<div class="indented"><p id="7948649d-6420-41fe-adaa-ab136f1f8492" class=""><mark class="highlight-teal">a) Write allocate</mark><div class="indented"><p id="21041cb9-d473-4c37-b39f-5beb50c4ba46" class="">Load block from memory into cache, then overwrite</p></div></p><p id="63319fcd-cc3d-49bf-bd5e-b9c76948e459" class=""><mark class="highlight-teal">b) Write non-allocate</mark><div class="indented"><p id="a0d2f995-28bf-4d5d-b8ed-4bb6a0d998a5" class="">Overwrite memory directly</p></div></p></div></p></div></p><p id="00dd9a61-b06f-4f29-ac0a-426242f9f786" class="">
</p><p id="f7a1e59b-f448-4bc7-831c-650ba0f7490c" class=""><mark class="highlight-blue">Types of misses</mark><div class="indented"><p id="7e35592a-8456-492d-a80a-3429b79b8dd9" class="">Cold cache<div class="indented"><p id="32a01b62-8058-4108-93d2-d380d8c44bf2" class="">Cache hasn’t been in use and is therefore empty.</p><ul id="a249f229-46f6-4a05-9191-7344c366e893" class="bulleted-list"><li style="list-style-type:disc">Cold miss 		every (read) memory access that is a cache-miss</li></ul></div></p><p id="5aa28a1c-62dc-4164-a273-fc72bb7fc5dd" class="">Warm cache<div class="indented"><p id="74de1b76-ed17-4758-9111-69c31401a244" class="">Cache has been in use.</p><ul id="a064ce61-f689-41aa-86ba-dab2aee0a71d" class="bulleted-list"><li style="list-style-type:disc">Capacity miss		entire cache full - some lines must be evicted</li></ul><ul id="3a2443a1-c05c-4aad-9caa-acb418d3fb71" class="bulleted-list"><li style="list-style-type:disc">Conflict miss		specific line is full (not necessarily the whole cache) - must be evicted</li></ul></div></p></div></p><p id="88567c31-11da-4968-ac6d-0026fffc9a7a" class="">
</p><p id="eeeb18f7-d134-46af-a976-72ca99153e40" class=""><mark class="highlight-blue">Hit-rate, miss-rate</mark><div class="indented"><p id="625cd327-e15e-4da8-b843-391b6f0d0cd9" class="">Memory references divided by number of instructions that hit or miss the catch.</p></div></p><p id="31ff7f68-38ac-402d-be79-b53321599696" class="">
</p><p id="4f1eb15a-55ce-4e8d-852a-a94b3e697199" class=""><mark class="highlight-blue">Eviction (removal) from cache</mark><div class="indented"><p id="3d30fc6f-8d13-4efe-b0be-a0b4979a0621" class="">When there is a capacity or conflict miss, the cache evicts line to make room for new one.</p><p id="269bdfc5-280a-4797-b468-8226a7f24121" class="">For direct mapping caches we use the mapping.</p><p id="80cad027-43fd-4f6e-b860-af19644cf753" class="">For associative caches:<div class="indented"><p id="107937fe-91d8-4080-8cad-1f125d302fa7" class=""><em>LRU least recently used</em></p><p id="1e269a09-5f28-4c17-bda9-bda327e9b627" class=""><em>LFU least frequently used</em></p><p id="ed02956e-545f-49fc-9730-fd4ee34851eb" class=""><em>Random replacement</em></p></div></p></div></p><p id="e3cd48c1-569a-4c2f-9551-bec3f268adf4" class="">
</p><p id="5fc01ede-f66a-4777-b28b-843634114e46" class="">
</p><h1 id="dd325803-d0a7-442b-a889-a2430612a232" class="">Cache impact on performance</h1><p id="efa21242-e44c-4373-a467-8849a04c1078" class="">Cache usually maintained in hardware (”free lunch”).</p><p id="ab88c183-4915-4ca7-9120-c8bd22a81dc7" class="">The cache impacts the sequential and parallel performance.</p><p id="605583ba-90a1-4838-9626-52feea42457c" class="">
</p><h2 id="4b8639f5-b6f2-466e-8050-e2f8f5e3371a" class="">Example: Matrix-Matrix multiplication</h2><p id="d5858003-caef-4cbe-a776-ea5514aa766b" class=""><mark class="highlight-blue">Matrix-Matrix multiplication</mark><div class="indented"><p id="551cf068-227b-4176-b870-10a33d03ee6a" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>C</mi><mo>=</mo><mi>A</mi><mo>⋅</mo><mi>B</mi></mstyle></mrow><annotation encoding="application/x-tex">\small C = A\cdot B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05017em;">B</span></span></span></span></span><span>﻿</span></span> (associative, distributive but not commutative)</p><p id="936d4f7d-bef0-41b8-80ba-1d6d3e07d6f0" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>C</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><msub><mo>∑</mo><mrow><mn>0</mn><mo>≤</mo><mi>k</mi><mo>&lt;</mo><mi>n</mi></mrow></msub><mi>A</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">]</mo><mo>⋅</mo><mi>B</mi><mo stretchy="false">[</mo><mi>k</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small C[i,j] = \sum_{0 \leq k &lt; n} A[i,k] \cdot B[k,j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.07153em;">C</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05724em;">j</span><span class="mclose sizing reset-size6 size5">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.041591em;vertical-align:-0.366591em;"></span><span class="mop sizing reset-size6 size5"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.14628333333333327em;"><span style="top:-2.2833233333333336em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mrel mtight">≤</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4073233333333333em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5">A</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.03148em;">k</span><span class="mclose sizing reset-size6 size5">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05017em;">B</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.03148em;">k</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05724em;">j</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span></p><pre id="3227454b-1726-427b-926f-0daa64f3806e" class="code"><code>for (i=0; i&lt;n; i++) {
	for (j=0; j&lt;n; j++) {
		C[i][j] = 0;
		for (k=0; k&lt;n; k++) {
			C[i][j] += A[i][k]*B[k][j];
		}
	}
}</code></pre><p id="e0da5afb-ee0c-4b91-a2ee-65ec409d64a8" class="">Simple implementation based on mathematical definition (not the best).</p><p id="4f8f71c5-e238-4562-8ce2-1cb37d6436ab" class="">Work 		<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938364em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.02778em;">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7926266666666666em;"><span style="top:-2.963em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></p><p id="2ba96253-561c-407f-8f76-c996f0fcf06e" class="">Complexity	<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>⋅</mo><msqrt><mi>m</mi></msqrt><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(m \cdot \sqrt m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.02778em;">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9452520000000001em;vertical-align:-0.225em;"></span><span class="mord sqrt sizing reset-size6 size5"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8002800000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="padding-left:0.833em;">m</span></span><span style="top:-2.76028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.23972em;"><span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span> where <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>m</mi><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup></mstyle></mrow><annotation encoding="application/x-tex">\small m = n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.387504em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.713364em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7926266666666666em;"><span style="top:-2.963em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span></p></div></p><p id="d8500d1a-69af-4613-b813-5482c54aca6f" class="">
</p><figure id="d0c4f60b-9a2b-4fc9-baf4-e5d53bfb7f37" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled-2022-05-23-2016.excalidraw.svg"><img style="width:240px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled-2022-05-23-2016.excalidraw.svg"/></a></figure><p id="672eead1-136e-4dad-b4a0-e3c5f9b2f625" class="">
</p><p id="3e2aaf4f-6f34-47d6-903b-930aff9fee7e" class=""><mark class="highlight-blue">Interchanging loops impacts the performance</mark><div class="indented"><p id="bf91a7f0-f7a9-465e-882f-695cc99e5ebe" class="">The 3 loops can be interchanged: <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.8em"><mn>3</mn><mo stretchy="false">!</mo><mo>=</mo><mn>6</mn></mstyle></mrow><annotation encoding="application/x-tex">\footnotesize 3! = 6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5555519999999999em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size4">3</span><span class="mclose sizing reset-size6 size4">!</span><span class="mspace" style="margin-right:0.3252777777777778em;"></span><span class="mrel sizing reset-size6 size4">=</span><span class="mspace" style="margin-right:0.3252777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.515552em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size4">6</span></span></span></span></span><span>﻿</span></span> possible variations. </p><ul id="eb3bd822-d840-4ded-8544-0b8fe974c331" class="toggle"><li><details open=""><summary>worst performance: 	<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.593568em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">i</span></span></span></span></span><span>﻿</span></span> as the innermost loop (jki, kji)</summary><pre id="8f5d6d07-958c-4e55-bdc3-4f212688e1ee" class="code"><code>for (k=0; k&lt;n; k++) {
	for (j=0; j&lt;n; j++) {
		for (i=0; i&lt;n; i++) {
			C[i][j] += A[i][k]*B[k][j];
		}
	}
}</code></pre><p id="fbaf716e-60a1-4b0f-9cf1-631ca7ddd931" class=""><mark class="highlight-gray"><code>B[k][j]</code></mark> is independent of <mark class="highlight-gray"><code>i</code></mark>.</p><p id="5dbaf55d-764f-42a6-a36a-4a1c4453f101" class="">Each iteration is 1 load for <mark class="highlight-gray"><code>A[i][k]</code></mark><mark class="highlight-gray"> </mark>and 1 store for <mark class="highlight-gray"><code>C[i][j]</code></mark>:<div class="indented"><p id="25e79354-6be5-48ad-8158-b1e7cdf7b532" class="">they both are cache misses (assuming cache can store 2 matrix rows at most).</p></div></p><p id="f7605b62-dfa3-40b1-8323-e460dfe54db5" class="">
</p></details></li></ul><ul id="4e3e92ba-64a5-44f5-8f7d-63d7e2b0363f" class="toggle"><li><details open=""><summary>medium performance:	<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>k</mi></mstyle></mrow><annotation encoding="application/x-tex">\small k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.624996em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.03148em;">k</span></span></span></span></span><span>﻿</span></span> as the innermost loop (ijk, jik)</summary><pre id="220254a0-d3b8-48d6-a4f0-5107d1e869a9" class="code"><code>for (i=0; i&lt;n; i++) {
	for (j=0; j&lt;n; j++) {
		C[i][j] = 0;
		for (k=0; k&lt;n; k++) {
			C[i][j] += A[i][k]*B[k][j];
		}
	}
}</code></pre><p id="7de7cfae-2abf-41fc-9e5d-de77e5628274" class=""><mark class="highlight-gray"><code>C[i][j]</code></mark> is independent of <mark class="highlight-gray"><code>k</code></mark> (update in register by compiler).</p><p id="b64afddc-dd5b-42c5-8f98-b8bc7d45b218" class="">Each iteration is 2 loads for <mark class="highlight-gray"><code>A[i][k]</code></mark>, <mark class="highlight-gray"><code>B[k][j]</code></mark> and 1 store for <mark class="highlight-gray"><code>C[i][j]</code></mark>:<div class="indented"><p id="863072cd-db0d-41e5-99d4-ded9378997b4" class="">each load of <mark class="highlight-gray"><code>B[k][j]</code></mark><mark class="highlight-gray"> </mark>is a cache miss because the matrix is accessed in row order. </p></div></p><p id="f79fa6dc-c352-4b78-89a4-e66a042ad4e4" class="">
</p></details></li></ul><ul id="d1895551-92a5-46b7-8dfd-1c589cf6ddd2" class="toggle"><li><details open=""><summary>best performance:		<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>j</mi></mstyle></mrow><annotation encoding="application/x-tex">\small j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.768564em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05724em;">j</span></span></span></span></span><span>﻿</span></span> as the innermost loop (ikj, kij)</summary><pre id="ed7a9928-fe21-43e7-9987-abc6c68ae7ab" class="code"><code>// initialize C[i][j] = 0;

for (i=0; i&lt;n; i++) {
	for (k=0; k&lt;n; k++) {
		for (j=0; j&lt;n; j++) {
			C[i][j] += A[i][k]*B[k][j];
		}
	}
}</code></pre><p id="6690e494-bebf-4348-9fff-7d2aadab9e1b" class=""><mark class="highlight-gray"><code>A[i][k]</code></mark> is independent of <mark class="highlight-gray"><code>j</code></mark> (update in register by compiler).</p><p id="de6f6fac-ea7b-4db0-9b3e-ee12777175c2" class="">Each iteration is 1 load for <mark class="highlight-gray"><code>B[k][j]</code></mark> and 1 store for <mark class="highlight-gray"><code>C[i][j]</code></mark>:<div class="indented"><p id="01fb4a10-5b84-4ec2-98b0-b7c4c8c3d85a" class="">Both are accessed in row order and the miss-rate is given by the cache-line size.</p><p id="6d4d61d2-4a6c-4e24-a56e-84c8229c81bc" class="">The spatial and temporal locality is exploited well.</p><p id="657e9e29-f883-4edc-8fcc-57d80fac4654" class="">
</p></div></p></details></li></ul></div></p><figure id="b237966a-c0f3-4684-8f90-2b15ceb1d266" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%207.png"><img style="width:144px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%207.png"/></a></figure><p id="e691ad36-2459-4b89-9ba3-1cb3f81ed0fa" class=""><div class="indented"><p id="3b69d2be-ba8e-4de2-88df-8d684263fe93" class="">This is because how C stores matrices.<div class="indented"><p id="cacb29fa-fc63-4a62-9345-ecc080869c8a" class="">Scanning the matrix in row order reduces the number of main-memory-accesses.</p><p id="0a1ebefe-c6f7-453f-978c-7f4021d970d4" class="">We load blocks of 8-16 elements into the cache.</p><p id="103ccc22-0c52-4838-bcb1-6eefb780a698" class="">If row &gt; cache, next row forces eviction.</p></div></p></div></p><figure id="718308f6-837e-46ff-90c3-88829c4992ac" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%208.png"><img style="width:336px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%208.png"/></a></figure><p id="d990c00b-07e6-407d-a735-be24ca8064a4" class="">
</p><p id="058ef4cb-a6cf-4953-b99c-71e11a287902" class=""><mark class="highlight-blue">Parallelization</mark><div class="indented"><p id="a383a9c3-1dec-45d8-b6c4-f310805de640" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mstyle></mrow><annotation encoding="application/x-tex">\small i,j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.768564em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05724em;">j</span></span></span></span></span><span>﻿</span></span> loops fully independent (data parallel).</p><p id="08d25868-1251-435c-aec0-adfe00a03ec9" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>k</mi></mstyle></mrow><annotation encoding="application/x-tex">\small k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.624996em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.03148em;">k</span></span></span></span></span><span>﻿</span></span> loop should be in increasing order (unless commutativity of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mo>+</mo></mstyle></mrow><annotation encoding="application/x-tex">\small +</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.599994em;vertical-align:-0.07499700000000001em;"></span><span class="mord sizing reset-size6 size5">+</span></span></span></span></span><span>﻿</span></span> is exploited)</p><pre id="8440de9f-f467-4a28-9af9-b1a4d2d36646" class="code"><code>par (0&lt;=i&lt;n, 0&lt;=j&lt;n) {
	C[i][j] = 0;
	for (k=0; k&lt;n; k++) {
		C[i][j] += A[i][k]*B[k][j];	
	}
}</code></pre></div></p><p id="e946bf3d-7b7b-4b9b-9123-722ff8d18983" class="">
</p><h2 id="ec5531b5-9214-4377-8e54-68e5d9b58d35" class="">Recursive solution</h2><p id="af55cd70-4f9b-4f5a-8975-338b6fde0e07" class=""><mark class="highlight-blue">Alternative solution: recursive</mark><div class="indented"><p id="e1649860-0509-4299-93f3-c15dae3d0a15" class="">Recursively splitting matrices in half in both dimensions.</p><p id="a6f760b2-10fc-42e4-a9a2-23cf9dabd693" class="">Each recursion level has 8 submatrix multiplications, 4 submatrix additions:</p><pre id="8f944903-37f9-47cb-b163-df41a8d71618" class="code"><code>C00 = A00 * B00 + A01 * B10
C01 = A00 * B01 + A01 * B11
C10 = A10 * B00 + A11 * B10
C11 = A10 * B01 + A11 * B11</code></pre><div id="89036a0d-e431-4516-bf14-7953785b5f68" class="column-list"><div id="3c9ec924-93b1-476c-864e-1df9c006c2ff" style="width:50%" class="column"><figure id="bcc7fe48-9d57-491a-a79c-458816526d7f" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%209.png"><img style="width:240px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%209.png"/></a></figure></div><div id="b6354a64-3271-4e96-b44b-cd8c8f87ff9c" style="width:50%" class="column"><figure id="ac1d167f-09f5-4355-b20d-0f458df58431" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2010.png"><img style="width:288px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2010.png"/></a></figure></div></div></div></p><p id="f37d8516-d3b4-4c21-9bed-244b94f538fd" class="">
</p><p id="117262bf-0ec8-47aa-bb1d-ee2ba39163be" class=""><mark class="highlight-gray"><em>Calculated using the master theorem</em></mark></p><p id="dd272719-d5fd-45df-92ec-eae150688897" class="">Work		<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>W</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>8</mn><mo>⋅</mo><mi>W</mi><mo stretchy="false">(</mo><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mn>2</mn><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small W(n) = 8 \cdot W(n/2)+ \Theta(n2
) = \Theta(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">W</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5799960000000001em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size5">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">W</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/2</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord sizing reset-size6 size5">Θ</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">2</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.938364em;vertical-align:-0.225em;"></span><span class="mord sizing reset-size6 size5">Θ</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7926266666666666em;"><span style="top:-2.963em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></p><p id="86c4cee6-3fce-43d8-a013-cec0cd5952ed" class="">			number of nodes in an matrix-multiplication DAG </p><p id="0f521427-1dca-4afa-8219-9baf3d167c76" class="">Time		<style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><munder><munder><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><mo stretchy="true">undefined</mo></munder><mtext>recursion depth</mtext></munder><mo>=</mo><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>n</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small T(n) = T(n/2)+ \underbrace{O(\log n)}_{\text{recursion depth}}
=\Theta(\log(n)^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">T</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">T</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/2</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.196528em;vertical-align:-1.5215280000000002em;"></span><span class="mord munder sizing reset-size6 size5"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7499999999999998em;"><span style="top:-1.4390399999999999em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">recursion depth</span></span></span></span></span><span style="top:-2.9999999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.75em;"><span class="svg-align" style="top:-2.102em;"><span class="pstrut" style="height:3em;"></span><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class="brace-center" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class="brace-right" style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.898em;"><span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.690586666666667em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.938364em;vertical-align:-0.225em;"></span><span class="mord sizing reset-size6 size5">Θ</span><span class="mopen sizing reset-size6 size5">(</span><span class="mop sizing reset-size6 size5">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7926266666666666em;"><span style="top:-2.963em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span></p><p id="3557e60b-d86b-4dee-90b0-d63fb065a286" class="">			length of the longest path</p><p id="7fd679cc-a095-4fca-bd13-80eb2a295086" class="">
</p><p id="15c615dd-9d96-4e7d-99cc-c1d162508168" class=""><mark class="highlight-blue">Cache behavior</mark><div class="indented"><p id="af015d0b-440c-4873-be46-d9e8a245745a" class="">Good - can be made <em>cache oblivious </em>(Good cache behavior is independent of actual cache size).</p><p id="11fc1aba-2594-4feb-a247-8459a810d062" class="">Can be made <em>cache-aware</em>: multiplying smaller matrices of size <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msup><mi>k</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>×</mo><msup><mi>k</mi><mrow><mo mathvariant="normal">′</mo><mo mathvariant="normal">′</mo></mrow></msup></mstyle></mrow><annotation encoding="application/x-tex">\small k&#x27; \times k&#x27;&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7350329999999999em;vertical-align:-0.07499700000000001em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333333em;"><span style="top:-2.963em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.660036em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7333733333333333em;"><span style="top:-2.963em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> so that they fit in cache (based on cache hierarchy).</p></div></p><figure id="a65e6e1a-e52d-483c-90aa-ba4683c4d55b" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2011.png"><img style="width:192px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2011.png"/></a></figure><p id="809832eb-824a-4dc2-899d-19adb8e542fc" class="">
</p><ul id="a7f4e5de-8b0c-4696-9837-82b18dc91102" class="toggle"><li><details open=""><summary><mark class="highlight-blue">Implementation in C</mark></summary><p id="41c25468-3e1e-4ef2-bb68-27073c633b3d" class="">Two dimensional arrays are pointers:<div class="indented"><p id="020ea9a9-d23d-43e0-8304-5682a8f667d8" class="">ie: <mark class="highlight-gray"><code>A[0][0 ... n-1]</code></mark> is between the pointers <mark class="highlight-gray"><code>A[0]</code></mark><mark class="highlight-gray"> </mark>and <mark class="highlight-gray"><code>A[1]</code></mark>.</p></div></p><p id="25332518-0673-40e2-9cc8-3d05cf816699" class="">We therefore represent each submatrix as <mark class="highlight-gray"><code>A[m0 ... m1][k0 ... k1]</code></mark>.</p><p id="80a45c96-f84e-456c-9190-5da5b3824352" class="">Result matrices ie. <mark class="highlight-gray"><code>c0</code></mark> have size <mark class="highlight-gray"><code>(m1-m0)x(n1-n0)</code></mark>.<div class="indented"><figure id="69f25a42-c6bb-4343-acc9-7fc30eac3401" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2012.png"><img style="width:192px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2012.png"/></a></figure></div></p><p id="ffe62d62-2d87-4b0f-96ff-43fde2e91e59" class="">
</p><p id="bb1878f0-2018-4fcb-b6cf-7d9f47b28616" class="">For the recursive calls submatrices are computed using offsets <mark class="highlight-gray"><code>mo</code></mark>, <mark class="highlight-gray"><code>no</code></mark>.</p><p id="f0096599-f80e-4fa1-99e7-47556dccf49b" class="">The recursion is stopped when the smallest matrix has size <mark class="highlight-gray"><code>m1-m0 &lt; CUTOFF</code></mark> (determined experimentally).</p><pre id="d1297e1d-958f-40e1-8d47-a09e0a15d2dc" class="code"><code>void MM(
	double A[][], double B[][],
	int m0, int m1, int k0, int k1, int n0, int n1,
	double C[][],
	int mo, int no // offset in c0, c1
) {
	if (/*n0,n1,k0,k1,m0,m1 too small: CUTOFF*/) {
		BaseMM(A,B,m0,m1,k0,k1,n0,n1,C,mo,no); // call other function with all args

	} else {
		double c0[m1-m0][n1-n0]; // output of top half of B
		double c1[m1-m0][n1-n0]; // output of bottom half of B

		// A (left-top quad) vs. B (top half) --&gt; C0 (top half)
		MM(A, B, m0, (m0+m1)/2, k0, (k0+k1)/2, n0, (n0+n1)/2, c0, 0, 0);
		MM(A, B, m0, (m0+m1)/2, k0, (k0+k1)/2, (n0+n1)/2, n1, c0, 0, (n1-n0)/2);

		// A (right-top quad) vs. B (bottom half) --&gt; C1 (top half)
		MM(A, B, m0, (m0+m1)/2, (k0+k1)/2, k1, n0, (n0+n1)/2, c1, 0, 0);
		MM(A, B, m0, (m0+m1)/2, (k0+k1)/2, k1, (n0+n1)/2, n1, c1, 0, (n1-n0)/2);
		
		// A (left-bottom quad) vs. B (top half) --&gt; C0 (bottom half)
		MM(A, B, (m0+m1)/2, m1, k0, (k0+k1)/2, n0, (n0+n1)/2, c0, m1-m0, 0);		
		MM(A, B, (m0+m1)/2, m1, k0, (k0+k1)/2, (n0+n1)/2, n1, c0, m1-m0, (n1-n0)/2);

		// A (right-bottom quad) vs. B (bottom half) --&gt; C1 (bottom half)
		MM(A, B, (m0+m1)/2, m1, (k0+k1)/2, k1, n0, (n0+n1)/2, c1, m1-m0, 0);		
		MM(A, B, (m0+m1)/2, m1, (k0+k1)/2, k1, (n0+n1)/2, n1, c1, m1-m0, (n1-n0)/2);

		// C = c0 + c1 (using offset)
		for (i=m0; i&lt;m1; i++) {
			for (j=n0; j&lt;n1; j++) {
				C[mo+i][no+j] = c0[i-m0][j-n0] + c1[i-m0][j-n0];
			}
		}

		... free memory of c0 and c1
	}
}</code></pre><p id="898fe0f9-ab21-4d83-b38d-648be113a1ae" class="">Call with <mark class="highlight-gray"><code>MM(A,B,0,m,0,k,0,n,C,0,0);</code></mark></p><p id="668e4f9f-fb0c-4670-9a8a-273f8ae35edc" class="">All MM calls are independent.</p></details></li></ul><p id="bbd2cfdd-3328-45fa-9472-9d0ff030c219" class="">
</p><p id="d55c5a2d-c77e-4d52-aed5-3aa985089129" class="">
</p><h1 id="23ae94b7-2646-4e77-b3db-a38da8fadca0" class="">Cache coherence</h1><p id="30df462a-2300-44f4-aa89-320db6d614c5" class=""><mark class="highlight-blue">Example: caches that are not coherent</mark><div class="indented"><p id="784fb8a1-82b9-4006-a2ea-9e09c508c722" class="">Core 0, 1 have private caches and both loaded address <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span>.<div class="indented"><ol type="1" id="b792d492-7a8a-4834-9ff1-918607548928" class="numbered-list" start="1"><li>Core 0 writes to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span></li></ol><ol type="1" id="8312d83b-497a-4ff5-8ea5-5d044f430291" class="numbered-list" start="2"><li>Core 1 wants to read <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span> but has a different value</li></ol></div></p></div></p><p id="159549ba-338e-4d4b-a02c-d1002df527eb" class="">
</p><p id="90e15c1c-4eef-4ea9-acd6-9ac9d7284c8b" class=""><mark class="highlight-blue">Definition: cache coherence</mark><div class="indented"><p id="5e28d563-a27c-4324-9f6c-d9e2be445e38" class="">Let order of memory accesses to specific address <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span> be given by program order.<div class="indented"><ol type="1" id="05173a57-9f9f-4d57-86c2-5627b22a03b3" class="numbered-list" start="1"><li>If processor <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span></span></span></span></span><span>﻿</span></span> writes to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> and no other writes occur (by any processor) before its next read of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> - then it must read the value it first wrote to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span>.</li></ol><ol type="1" id="480cc100-ac96-4480-9e26-d83e49353520" class="numbered-list" start="2"><li>If <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> writes to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> and no other writes occur (by any processor) afterwards until <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> reads <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> - then <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> must read the value <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> first wrote to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span>.</li></ol><ol type="1" id="2f582eb2-19f3-4140-a6a2-5e6486232a6e" class="numbered-list" start="3"><li>If <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> write to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> at the same time, then only one write is stored at <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span>.    </li></ol></div></p><ul id="7f1d1e46-dc7e-4262-9ffd-450518027077" class="toggle"><li><details open=""><summary>More formal definition</summary><ol type="1" id="ec131798-f7cd-41ac-b472-67632b948ae7" class="numbered-list" start="1"><li>If processor <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span></span></span></span></span><span>﻿</span></span> writes to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> at time <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and reads <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> at <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub><mo>&gt;</mo><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2&gt;t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>,
and there are no other writes (by <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span></span></span></span></span><span>﻿</span></span> or other) to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> between <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>, then <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span></span></span></span></span><span>﻿</span></span> reads the value written at <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>.</li></ol><ol type="1" id="91771149-6170-4154-9a7c-fc4bdc44de65" class="numbered-list" start="2"><li>If <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> writes to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> at <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and another <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> reads a at <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub><mo>&gt;</mo><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2&gt;t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and no other <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span></span></span></span></span><span>﻿</span></span> writes to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span>between <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>, then <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> reads the value written by <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> at <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span>.<p id="b644a85c-b6fe-4af7-ad71-1fcc12cfe55d" class="">But there must be sufficient space between <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>t</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small t_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.688572em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> until the updates become visible (there is no absolute time and nothing is immediate).</p></li></ol><ol type="1" id="e914138d-4e8e-415b-9599-f5eca2ca5d78" class="numbered-list" start="3"><li>If <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> and <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> write to <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span> at the same time, then either the value of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>1</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> or the value of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>P</mi><mn>2</mn></msub></mstyle></mrow><annotation encoding="application/x-tex">\small P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.749997em;vertical-align:-0.135em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span style="top:-2.45em;margin-left:-0.13889em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span>﻿</span></span> is stored at <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="pink"><mi>a</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{pink} a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="color:pink;">a</span></span></span></span></span><span>﻿</span></span>.<p id="af201def-9093-4008-a83b-337794c64e60" class="">Same time means “sufficiently close” in time - the writes must be “serialized”.</p></li></ol></details></li></ul></div></p><p id="2b572642-eb89-4c69-b52b-849e674e0c58" class="">
</p><p id="3aeacc7a-b84f-4721-9f97-7b168ebdffeb" class=""><mark class="highlight-blue">ccNUMA-Systems</mark><div class="indented"><p id="f692cbf0-c34e-4cf4-9ff6-9548d98f02bb" class="">(most multi-core and symmetric multiprocessing SMP nodes)</p><p id="93e96303-0d11-4c8e-be68-dd9ec6f3d886" class="">Cache coherence at cache-line-level, maintained by hardware-protocols.</p><p id="a354fa6a-9584-4f50-b96c-ac2c03d59695" class="">This negatively impacts the performance: bus/network traffic, protocol overhead, transistors and power.</p><p id="fd9b65c8-669b-4d58-ae0f-8166381ab3a2" class=""><mark class="highlight-gray">Note: Not all systems are cache coherent (ie. NEC Vector computers)</mark></p></div></p><p id="62658ddb-b40e-47a6-911d-07dde7ac5a76" class="">
</p><h2 id="a10da41d-3025-47ae-9be8-b631806d86db" class="">False sharing</h2><p id="f5665b94-e1c4-489f-9001-663c20df22f5" class=""><mark class="highlight-blue">Sharing / false sharing</mark><div class="indented"><p id="4bd2d9ef-430f-4f74-aabf-3dbfc352fb4d" class="">Cache coherence is maintained at cache-line-level.</p><p id="35922c27-38cd-41a0-b46b-1c63bf54a62f" class="">Two different addresses are written to cache - but the entire cache-line must be updated.</p></div></p><p id="4087c2ce-5fd2-441d-8b93-f3ab3ebc523d" class="">
</p><p id="ad0f68d1-be41-40b0-bf35-34d3061c2118" class=""><mark class="highlight-blue">Avoiding false sharing</mark><div class="indented"><p id="ac1cef5a-c2ac-4417-a7e0-496016488ff8" class="">Simple, shared variables updated by different threads should be in different cache-lines.</p><p id="0465e1ce-0ce7-4d15-9430-9bb5f2f40d48" class="">Solutions:<div class="indented"><ul id="a03f4244-0cc1-4592-955e-519012e7a522" class="bulleted-list"><li style="list-style-type:disc">Simple local variables → compiler might put them in different cache lines</li></ul><ul id="87ea87d3-10d4-497f-9655-154e27429731" class="bulleted-list"><li style="list-style-type:disc">Pad data-structures (ie. padded array) → wastes a lot of memory</li></ul></div></p></div></p><figure id="9f911ed5-087a-4399-aeae-afb134a44405" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2013.png"><img style="width:384px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2013.png"/></a></figure><p id="b1b7ddb7-ff5e-4ae0-8f56-6d8e137c8422" class="">
</p><p id="49779e9a-9d6a-4feb-a399-7c10e0f707a0" class=""><mark class="highlight-blue">Example 1) unnecessary update</mark><div class="indented"><p id="a65c87e6-d8d7-419a-b498-31c4396b1f81" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span></span></span></span></span><span>﻿</span></span> are both in the same cache-line.<div class="indented"><p id="b5ece1a7-4c5a-423c-9292-86ec080bd3a0" class="">core0 updates <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span></span><span>﻿</span></span> in a loop, core1 updates <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span></span><span>﻿</span></span> in a loop.</p><p id="77441850-d8c0-4eb5-874b-083fa9db5f4f" class="">Although <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span></span></span></span></span><span>﻿</span></span> are in different memory locations, each update will cause a cache coherency activity (although unnecessary).</p></div></p><p id="95f4c216-8d7e-4a30-83a8-ed9e9489f790" class="">Variables <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">b</span></span></span></span></span><span>﻿</span></span> are called “falsely shared”.</p></div></p><p id="6bf826cc-8ec9-49cd-b24f-2525cfbad342" class="">
</p><p id="dc9be2a7-db57-4766-858f-8a625e9d57fb" class=""><mark class="highlight-blue">Example 2) storing sum of rows: row-major</mark><div class="indented"><p id="d769e3db-e3cd-4689-a77d-041d82af4f6c" class="">Storing row sums at index <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mn>0</mn></mstyle></mrow><annotation encoding="application/x-tex">\small 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5799960000000001em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size5">0</span></span></span></span></span><span>﻿</span></span> in matrix: <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>a</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><msub><mo>∑</mo><mi>i</mi></msub><mi>a</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small a[j][0]  = \sum_i a[j][i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05724em;">j</span><span class="mclose sizing reset-size6 size5">]</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord sizing reset-size6 size5">0</span><span class="mclose sizing reset-size6 size5">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9600090000000001em;vertical-align:-0.285009em;"></span><span class="mop sizing reset-size6 size5"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1230033333333333em;"><span style="top:-2.2833233333333336em;margin-left:0em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.31667666666666666em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05724em;">j</span><span class="mclose sizing reset-size6 size5">]</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span></p><p id="27a2cfbe-2bfc-4173-9489-2fbe54f5c054" class="">Matrix is stored row-major in C.<div class="indented"><p id="89325a27-57ac-49c9-a820-b1d6eca354d4" class="">Therefore all <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small a[i][0] </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mclose sizing reset-size6 size5">]</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord sizing reset-size6 size5">0</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span> are most likely in different cache lines.</p><p id="c0ab3d71-c241-48c1-97a9-d3c0ebcf1d51" class="">The rows <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>j</mi></mstyle></mrow><annotation encoding="application/x-tex">\small j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.768564em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05724em;">j</span></span></span></span></span><span>﻿</span></span> and <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>j</mi><mo>+</mo><mn>1</mn></mstyle></mrow><annotation encoding="application/x-tex">\small j +1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.768564em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.5799960000000001em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size5">1</span></span></span></span></span><span>﻿</span></span> are not spatially close and wont be updated based on eachother.</p></div></p><pre id="9a304fcf-b578-44c9-ae4d-b9d8eea99465" class="code"><code>// a[m][n] two dimensional matrix
int *a = (int*)malloc(m*n*sizeof(int));

// row order access
#pragma omp parallel for
for (j=0; j&lt;m; j++) {
	int *x = a+j*n; // get address of row
	int i;
	for (i=1; i&lt;n; i++) { // sum all elements of row and store in [0]
		x[0] += x[i];
	}
}</code></pre></div></p><figure id="99379434-5e90-4f55-bf4b-499e4bb8823b" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2014.png"><img style="width:240px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2014.png"/></a></figure><p id="dc5309f3-1fac-4ded-8f1f-4ba510e8536f" class="">
</p><p id="eb1ce6f0-7a1b-42e8-ac62-608b39125a22" class=""><mark class="highlight-blue">Example 3) storing sum of rows: col-major</mark><div class="indented"><p id="39d4945a-3765-4c46-b706-76bfcbd2fceb" class="">same problem as above</p><p id="dc531cef-e1ee-471d-ba08-1f83e6c6bc47" class="">Matrix is stored col-major in FORTRAN.<div class="indented"><p id="97cf5bed-0dc3-4284-981d-c5c6253fccaf" class="">Therefore all <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\small a[i][0] </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5">a</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord mathnormal sizing reset-size6 size5">i</span><span class="mclose sizing reset-size6 size5">]</span><span class="mopen sizing reset-size6 size5">[</span><span class="mord sizing reset-size6 size5">0</span><span class="mclose sizing reset-size6 size5">]</span></span></span></span></span><span>﻿</span></span> are most likely in the same cache line and are updated <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi><mo>⋅</mo><mi>n</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p\cdot n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.575001em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.387504em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">n</span></span></span></span></span><span>﻿</span></span> times.</p></div></p><pre id="af99871f-72b0-4399-b698-95441e1d981f" class="code"><code>// x[m][n] two dimensional matrix
int *a = (int*)malloc(n*m*sizeof(int));

// row order access
#pragma omp parallel { // assuming p = m
	int t = omp_get_thread_num(); // thread id
	int i, j;
	int *x = a;
	for (j=t+p, i=1; i&lt;n; i++,j+=p) {
		x[t] += x[j];
	}
}</code></pre><ul id="c6f6327a-4dfd-44ba-884d-514caa78833b" class="toggle"><li><details open=""><summary>implementation with variable</summary><p id="a0bc1150-d8a4-4083-9d50-4629d0b27354" class="">should have no false sharing (as the original FORTRAN implementation).</p><p id="482f5a41-36de-4894-b8ac-f513493d581d" class="">But compiler might put the variable in a different cache-line. </p><pre id="27450d07-5118-49d3-aef1-ca066b9292e6" class="code"><code>// x[m][n] two dimensional matrix
int *a = (int*)malloc(n*m*sizeof(int));

// row order access
#pragma omp parallel {
	int t = omp_get_thread_num(); // thread id
	int i, j;
	int *x = a;
	register int sum = 0;
	for (j=t+p, i=1; i&lt;n; i++,j+=p) {
		sum += x[j];
	}
	x[t] = sum;
}</code></pre></details></li></ul></div></p><figure id="dfbf67bc-29fe-4393-b881-c3079ed55dcb" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2015.png"><img style="width:240px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2015.png"/></a></figure><p id="6732e5ba-8fa7-40c9-b9cf-ef8d4077caef" class="">
</p><p id="b2759679-1c04-42c0-9a44-98ac1edd2a4c" class="">
</p><h1 id="5af19b64-5c56-477d-b6dc-6da18675de9c" class="">NUMA memory performance</h1><p id="8b1c8911-17b6-491f-8303-e43a79f14acc" class=""><mark class="highlight-blue">Memory (”von Neumann”) bottleneck in NUMA</mark><div class="indented"><p id="e73e6a90-7258-4c42-9bbb-0e7663a295fb" class="">The memory access times are non-uniform:<div class="indented"><p id="3a0c6acf-6f3d-4f36-87df-179a3424a7a5" class="">Memory closer to a core is faster than memory on another CPU</p></div></p><ul id="a507090b-8f8b-434f-b1ea-255f1b38d290" class="toggle"><li><details open=""><summary>other problems</summary><ul id="04a08323-96d3-4593-8521-a4412997c2a9" class="bulleted-list"><li style="list-style-type:disc">Connection to memory via memory controllers (prefered by memory in bank)</li></ul><ul id="c990eb66-eb97-4f9d-92b6-51a52b9bd185" class="bulleted-list"><li style="list-style-type:disc">Less memory controllers than cores and they all share the same memory bandwidth</li></ul></details></li></ul></div></p><figure id="5a0e4fb3-a35d-48eb-ae5e-ccd5faae1a9b" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled.png"><img style="width:240px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled.png"/></a></figure><p id="304d9aad-1589-47be-8743-3119660e6efe" class="">
</p><p id="dc107910-9072-4a3e-8de0-0b5359ad703f" class=""><mark class="highlight-blue">First touch</mark><div class="indented"><p id="3c6eb1ff-2731-4789-a251-170d37298faf" class="">Applications try to allocate memory from closer to cores.</p><p id="d794d6d3-72e4-4f95-9756-b784d51ada68" class="">“First-touch” OS support:<div class="indented"><p id="1f22fa8d-b57d-4b95-92d7-2e42beabe0e6" class=""><em>“The first core (thread) to touch a virtual memory page will cause the virtual page to be allocated in memory close to that core”</em></p><p id="a30a3fc0-0c41-4e4d-a033-ba4a489be6dc" class="block-color-gray">This also means that threads that allocate later, are forced to use memory farthest away (remote instead of local).</p></div></p></div></p><p id="3d127743-d984-4e11-b2d8-6610ec47ec84" class="">
</p><p id="22201610-acb2-4d29-9a34-895effc4fc62" class=""><mark class="highlight-blue">Latency hiding techniques</mark><div class="indented"><p id="14fd0c78-4fc3-44df-85dc-78dfbec84cfb" class=""><em>These techniques hide latency, but bandwidth must still be suitable for memory requests.</em></p><p id="d6747318-e350-4ca5-ac85-0c64e97df081" class=""><mark class="highlight-teal">Prefetching</mark><div class="indented"><p id="db9a53f0-92d5-4f38-8974-bdda0d547de6" class="">Start loading operands well before use.</p></div></p><p id="0ec8c8c2-205f-4499-9acb-a72033cf666e" class=""><mark class="highlight-teal">Multi-threading</mark> (via hardware or software)<div class="indented"><p id="319f1808-525a-48d9-9715-ba0166518190" class="">switching between virtual processors when a thread requests data and coming back when data arrived.</p><p id="55fe078f-d630-4c8f-8fff-86daf3c266c4" class="">(requires explicit parallel instruction computing EPIC)</p></div></p></div></p><p id="3a808284-7272-4408-ac1d-28d5116b6c09" class="">
</p><p id="0998de23-0f3f-433e-91a8-79c13ad5cc9d" class=""><mark class="highlight-blue">Memory hierarchy and latency</mark><div class="indented"><p id="9d9ae76b-d093-4c0c-883a-266a4f5d1f13" class="">Registers			0 cycles</p><p id="6ac6549f-19cb-446a-8183-0fc1c1d14e72" class="">L1 cache			1 cycle</p><p id="39ff175b-c71d-481c-a0a3-132a2d35118d" class="">L2 cache			10 cycles</p><p id="08140d99-48d3-4a2a-8093-a531bcb3321e" class="">L3 cache			30 cycles</p><p id="106c1291-2f27-4b39-a54c-0271475d3c9a" class="">Main memory		100 cycles</p><p id="3d813916-226c-47f3-867d-df3c6fa7c152" class="">Disk				100.000 cycles</p><p id="53ce79fe-d2d9-445c-88d9-740dba471c4f" class="">Tape				10.000.000 cycles</p></div></p><div id="d5804556-9abd-44fd-a4e0-d766e5593230" class="column-list"><div id="45bebf23-88b0-403c-b782-9f5752bc76a2" style="width:33.333333333333336%" class="column"><figure id="8f1950f9-3762-4bca-ac55-3a2fc32f6c3f" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2016.png"><img style="width:144px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2016.png"/></a></figure></div><div id="42a75d5c-d678-49c2-9f1e-fe618e07c7e2" style="width:33.333333333333336%" class="column"><figure id="5439b4ee-0dc1-4aa9-a8d0-b38e77655c65" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2017.png"><img style="width:192px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2017.png"/></a></figure></div><div id="575a2722-1f1f-4900-bb8f-4084ee787e95" style="width:33.33333333333333%" class="column"><figure id="f97e1f39-e02f-4199-a784-02c31595cdd1" class="image"><a href="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2018.png"><img style="width:1154px" src="Memory%20and%20Caching%209fb4574bdbd04e3087cb590f646190a8/Untitled%2018.png"/></a></figure></div></div><p id="526cb5df-d6ba-46f0-a3b1-c2f399382c3f" class="">
</p><h2 id="f6d6d04c-8a90-4d24-97dd-889db14ea01a" class="">Super-linear speedup</h2><p id="19916f2e-23fa-42ad-b044-11d8501c6f03" class=""><mark class="highlight-blue">Super-linear speedup is impossible — Previous proof: simulation argument</mark><div class="indented"><p id="6c7ff0c3-c7d2-486f-a43b-d878c868a952" class="">Simulation argument: linear/perfect speedup is the best possible.<div class="indented"><p id="7557dcc3-f2d2-4895-9cd3-51f74f1df32e" class="">Simulation argument assumes that parallel and sequential processors behave similarly = same memory behavior.</p><p id="c49b90ca-cf85-4cdb-b7c6-24dfda637386" class="">This is not true for real systems with a deep memory hierarchy.</p></div></p></div></p><p id="af5cda30-82d9-4a94-a388-5f079e08680c" class="">
</p><p id="c33d69fb-7652-44d6-a754-f6f76efd7a1f" class=""><mark class="highlight-blue">Definition</mark><div class="indented"><p id="717b987d-223a-4e98-9f77-432ac452f583" class="">single processor		input size <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.387504em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">n</span></span></span></span></span><span>﻿</span></span>, has access to deep memory hierarchy</p><p id="dd1e5383-ef3a-4422-9478-309289cc3d87" class="">multiple processors		input size <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi><mi mathvariant="normal">/</mi><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n/p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>, each have full access to main memory and cache</p></div></p><p id="06166d01-2f89-4323-a032-a63c95fd2e08" class=""><div class="indented"><p id="1129587f-01ee-464d-839d-84c184d1e373" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>ref</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small \text{ref}(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord text sizing reset-size6 size5"><span class="mord">ref</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>		number of memory references			</p><p id="d34fa9c9-b492-4d35-a23b-f9a18cc620fd" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>Mseq</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small \text{Mseq}(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord text sizing reset-size6 size5"><span class="mord">Mseq</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>		avg time per reference for a single processor (deep hierarchy)</p><p id="ed863528-c844-4630-8f13-601201dfbad4" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>Mpar</mtext><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small \text{Mpar}(p,n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord text sizing reset-size6 size5"><span class="mord">Mpar</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span>	avg time per reference for a single processor in parallel system (flat hierarchy)</p><p id="0e559457-b1c2-44ed-a674-fbec20536a48" class="">
</p><p id="fa2a9f0f-8957-4295-9205-7d96833a2aeb" class="">If performance is defined by cost of memory references:</p><figure id="de8fd12a-af21-4830-8c0b-5347b1ea6510" class="equation"><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><div class="equation-container"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>S</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mtext>ref</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>⋅</mo><mtext>Mseq</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><mrow><mtext>ref</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mi>p</mi><mo>⋅</mo><mtext>Mpar</mtext><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><mi>p</mi><mo>⋅</mo><mfrac><mrow><mtext>Mseq</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><mrow><mtext>Mpar</mtext><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\small S_p(n) = \frac{\text{ref}(n) \cdot \text{Mseq}(n)}{\text{ref}(n)/p \cdot \text{Mpar}(p,n)} = p \cdot \frac{\text{Mseq}(n)}{\text{Mpar}(p,n)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9266640000000002em;vertical-align:-0.25166400000000005em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.13703999999999994em;"><span style="top:-2.45em;margin-left:-0.05764em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span></span></span></span></span></span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.1267em;vertical-align:-0.8424em;"></span><span class="mord sizing reset-size6 size5"><span class="mopen nulldelimiter sizing reset-size5 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">ref</span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">Mpar</span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">ref</span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">Mseq</span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size5 size6"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.575001em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.1267em;vertical-align:-0.8424em;"></span><span class="mord sizing reset-size6 size5"><span class="mopen nulldelimiter sizing reset-size5 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Mpar</span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Mseq</span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size5 size6"></span></span></span></span></span></span></div></figure></div></p><ul id="e35528e2-d7a3-44c1-897e-d5dbab4cc007" class="toggle"><li><details open=""><summary>Example</summary><p id="ee11ceb7-f80d-4bdf-b9ad-7987fb809539" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>Mseq</mtext><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1000</mn></mstyle></mrow><annotation encoding="application/x-tex">\small \text{Mseq}(n) = 1000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord text sizing reset-size6 size5"><span class="mord">Mseq</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5799960000000001em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size5">1000</span></span></span></span></span><span>﻿</span></span></p><p id="f8ca6dec-4fa4-4dfa-870b-7d5c1c0617af" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mtext>Mpar</mtext><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>100</mn></mstyle></mrow><annotation encoding="application/x-tex">\small \text{Mpar}(p,n) = 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord text sizing reset-size6 size5"><span class="mord">Mpar</span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">p</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5799960000000001em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size5">100</span></span></span></span></span><span>﻿</span></span> (independent of <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>n</mi><mo separator="true">,</mo><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small n, p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5625em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mpunct sizing reset-size6 size5">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>)</p><p id="94c69d16-ed7a-48c0-a039-21f5d8f6afdd" class="">This would give us super a super-linear speedup<div class="indented"><p id="1de224d1-6abd-4dd8-bc4a-041cc2f30445" class="">(wrong term, since its linear but greater than <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5625em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span>).</p><p id="f258ed27-bca6-4cad-8df9-8cc58c278f74" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><msub><mi>S</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mo>⋅</mo><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small S_p(n) = 10 \cdot p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9266640000000002em;vertical-align:-0.25166400000000005em;"></span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.13703999999999994em;"><span style="top:-2.45em;margin-left:-0.05764em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2796266666666667em;"><span></span></span></span></span></span></span><span class="mopen sizing reset-size6 size5">(</span><span class="mord mathnormal sizing reset-size6 size5">n</span><span class="mclose sizing reset-size6 size5">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5799960000000001em;vertical-align:0em;"></span><span class="mord sizing reset-size6 size5">10</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size5">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.5625em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span></p></div></p></details></li></ul><p id="1bfa6599-c0f5-4789-a739-373fd801f95f" class="">
</p><h2 id="bca2a9e3-f963-42d4-8ee1-f51140dfbb6a" class="">Application performance and memory system</h2><p id="4a88c041-1ac4-44af-b7a7-7b0121a7ffc1" class=""><mark class="highlight-blue">Bounds for applications (”roofline performance / estimate model”)</mark><div class="indented"><p id="6de76894-a1d6-4cea-829b-9898b2ecfb92" class=""><em>Memory bound</em>		time operating on data &lt; time reading/writing data</p><p id="80eab1ff-49f6-4365-963a-c2f47837ce4e" class=""><em>Compute bound</em>		time operating on data &gt; time reading/writing data</p><ul id="60a621ab-7171-4631-bb2f-025513ddd8d9" class="toggle"><li><details open=""><summary><mark class="highlight-gray">formal definition</mark></summary><p id="4dd4dbac-c059-4193-8c99-235dc40f4086" class="">Given Implementation <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>A</mi></mstyle></mrow><annotation encoding="application/x-tex">\small A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">A</span></span></span></span></span><span>﻿</span></span> on multi-core system:<div class="indented"><p id="2fc9e92e-b50f-428a-8766-424ab200b507" class="">performance <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span></span></span></span></span><span>﻿</span></span> 			= ie. in operations/s or other measure</p><p id="938cab6a-c9e9-4c8e-977c-d829d1c03774" class="">operational intensity <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi></mstyle></mrow><annotation encoding="application/x-tex">\small O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.02778em;">O</span></span></span></span></span><span>﻿</span></span>		= average num of operations per byte read/written</p><p id="ac699a03-4ab8-4060-883e-21b2d7a9b03e" class="">memory bandwidth <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>B</mi></mstyle></mrow><annotation encoding="application/x-tex">\small B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05017em;">B</span></span></span></span></span><span>﻿</span></span></p></div></p><hr id="11322233-b52e-4eac-a2b3-e59ad83d340a"/><p id="0990de47-f616-430b-8a29-1305006f9366" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>A</mi></mstyle></mrow><annotation encoding="application/x-tex">\small A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">A</span></span></span></span></span><span>﻿</span></span> is memory bound, if <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi><mi mathvariant="normal">/</mi><mi>O</mi><mo>&gt;</mo><mi>B</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P/O &gt; B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05017em;">B</span></span></span></span></span><span>﻿</span></span></p><p id="91f78243-5726-4304-966c-e4c2e664a134" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>A</mi></mstyle></mrow><annotation encoding="application/x-tex">\small A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5">A</span></span></span></span></span><span>﻿</span></span> is compute bound, if <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi><mi mathvariant="normal">/</mi><mi>O</mi><mo>≤</mo><mi>B</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P/O \leq B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span><span class="mord sizing reset-size6 size5">/</span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size5">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.05017em;">B</span></span></span></span></span><span>﻿</span></span></p><p id="48e57723-4874-4a09-ba37-79906df7fee2" class="">
</p></details></li></ul><ul id="9cd83f34-0ddb-4ec7-b935-41ab7039950a" class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><p id="4b9ad840-83bc-49bd-9223-77b28ddc0471" class="">memory bound algorithms<div class="indented"><p id="b55b82b6-61f8-449b-aa75-c523ed676947" class="">Merge, prefix-sums → few operations per byte</p></div></p><p id="b3d782a6-203a-46b1-90f6-142dc93d5980" class="">less memory bound algorithms<div class="indented"><p id="9616e1a9-788d-4a18-86c2-0695e898e902" class="">Matrix-matrix multiplication → <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938364em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.02778em;">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7926266666666666em;"><span style="top:-2.963em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span> operations on <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\small O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938364em;vertical-align:-0.225em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.02778em;">O</span><span class="mopen sizing reset-size6 size5">(</span><span class="mord sizing reset-size6 size5"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7926266666666666em;"><span style="top:-2.963em;margin-right:0.05555555555555556em;"><span class="pstrut" style="height:2.6em;"></span><span class="sizing reset-size5 size2 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size6 size5">)</span></span></span></span></span><span>﻿</span></span> data</p></div></p><hr id="8fc2eb8b-8833-4461-ad5c-80e0d00d24ef"/><p id="7d1fb6fd-71a1-46aa-9d31-8bc940d5e128" class="">Example: Assuming prefix sums performs<div class="indented"><p id="7bc1fb8d-06d8-495d-9221-8286f72ab196" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>O</mi></mstyle></mrow><annotation encoding="application/x-tex">\small O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.02778em;">O</span></span></span></span></span><span>﻿</span></span> = 1/16 FLOP per Byte<div class="indented"><p id="645784e6-8592-4646-b3a6-b1879150f51c" class="">1 FLOP per 8 Byte word read and written (16 Bytes)</p></div></p><p id="7413b5ab-ade7-474c-9544-b2805dbc8c3a" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>P</mi></mstyle></mrow><annotation encoding="application/x-tex">\small P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.614997em;vertical-align:0em;"></span><span class="mord mathnormal sizing reset-size6 size5" style="margin-right:0.13889em;">P</span></span></span></span></span><span>﻿</span></span> = 2 GFLOPs</p><p id="d64357fd-f84f-4503-9d86-a4822d17febb" class="">Then it is memory bound is bandwidth is &lt; 32GByte/s.</p><p id="b4d83259-af31-4838-b472-03e299fb9056" class="">
</p></div></p></details></li></ul><p id="129ff2c3-1cd0-41df-afcb-40e0abde91fc" class="">If <em>memory bound</em>, speedup is limited by memory bandwidth (= How much faster can <style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5625em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span> cores read/write than only one core?)</p></div></p><p id="0ef1d595-d207-4089-b360-20ff5597296a" class="">
</p><p id="366aa4fb-63d7-4b1f-9ffb-8325b7a8743e" class="">
</p><h1 id="6b55598f-c0b9-4067-b327-b527372a7195" class="">Program order and memory consistency</h1><p id="35b7875f-f298-405e-b982-89b28b75e9cf" class="">Execution-order is not always program-order.</p><p id="8e5a120c-0fb7-43a2-b73a-9a9f350e3a07" class="">
</p><p id="e451e417-e0e6-49e2-bfea-019380be271f" class=""><mark class="highlight-blue">Sequential program order</mark><div class="indented"><p id="26496411-7dd5-4ae2-a5eb-c151fb6b688b" class="">Sequential consistency</p><p id="affed050-afdd-4274-998b-e3de51cc9aae" class="">
</p></div></p><p id="c051527a-8d17-4682-8796-624590bb9ef1" class=""><mark class="highlight-blue">Parallel program order</mark><div class="indented"><p id="31c6bfd3-e7f6-4bf2-943c-b9b4489c87a7" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathsize="0.9em"><mi>p</mi></mstyle></mrow><annotation encoding="application/x-tex">\small p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5625em;vertical-align:-0.174996em;"></span><span class="mord mathnormal sizing reset-size6 size5">p</span></span></span></span></span><span>﻿</span></span> processors execute some interleaving of parallel program (SPMD or MIMD).</p><p id="05c7b7a0-e5c7-4bdc-a16b-998362c7058a" class="">Possible: sequential consistency, relaxed consistency</p><ul id="3e487c5b-434d-4b5a-bddb-dc7a887ee881" class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><div id="1b8c20a0-78e9-4a58-bba9-43a7f6093bad" class="column-list"><div id="fef80bb5-b2ee-4e40-92d8-14bd8cae2c63" style="width:50%" class="column"><pre id="4fca55db-b541-4831-b654-0dbe19bb662d" class="code"><code>a = 1;
a = 2; // last assignment to a
b = 3; // last assignment to b</code></pre></div><div id="5844614b-01ee-44cd-9d36-119b4383ade0" style="width:50%" class="column"><pre id="ad688459-f887-43bf-8958-b7aa401b0dfd" class="code"><code>b = 7; // last assignment to b
a = 1;
a = 2; // last assignment to a</code></pre></div></div><p id="7360d2f0-a93c-4998-80b6-3990e3ad6454" class="">Possible outcomes:<div class="indented"><ul id="0daf79c6-8f5e-4b45-981a-e565da932a42" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-gray"><code>a = 2</code></mark>, <mark class="highlight-gray"><code>b = 3</code></mark></li></ul><ul id="52bc93b4-1af1-47bd-b625-623b134787f2" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-gray"><code>a = 2</code></mark>, <mark class="highlight-gray"><code>b = 7</code></mark></li></ul></div></p><p id="98016d96-480c-462d-9ca5-a2e7a945f9fe" class="">Impossible outcomes:<div class="indented"><ul id="6e47695f-09e7-43b5-a5b1-3855c17ee4a2" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-gray"><code>a = 1</code></mark>, <mark class="highlight-gray"><code>b = 3</code></mark></li></ul><p id="a402a883-c240-4f96-9088-a44b70c81e69" class="">
</p></div></p></details></li></ul></div></p><p id="b12a2cb0-07eb-45cf-8278-e90e5e8ef5a4" class="">
</p><h2 id="246cc8cd-bc79-421b-94f8-8ec6814f601f" class="">Consistency models</h2><p id="25c5b86f-b44c-4ef6-8c67-a4579261030a" class=""><mark class="highlight-blue">Memory consistency (Problem)</mark><div class="indented"><p id="1acdd7c5-a994-44dd-8331-90304580fd30" class="">What view do threads have of the memory?</p><p id="0f9f788c-7bb0-4c25-9e58-88f8eb548cad" class="">In what order do writes to different locations in memory become visible to other cores? </p><ul id="c4cba99c-0139-4379-be6c-bddb25ef7555" class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><div id="38a6978d-5367-4e11-a8ec-263d412dee2f" class="column-list"><div id="0a1713e3-5825-49d7-b08c-c2e97d4dfcec" style="width:50%" class="column"><pre id="b92f36ae-dc50-4efb-a1d2-9e991f96e552" class="code"><code>x = 0;
// … some code
x = 1;
if (y==0) {
	// body
}</code></pre></div><div id="3fa84872-ba9f-4cdb-a83b-d85890613b3e" style="width:50%" class="column"><pre id="66a66fa0-2aef-483e-8eca-49fb120d37c8" class="code"><code>y = 0;
// … some code
y = 1;
if (x==0) {
	// body
}</code></pre></div></div><p id="aa605f6d-76fb-41b3-855b-340324912a8d" class="">Question: can core0 and core1 both execute the body of the if-statement?</p><p id="0ec0edbf-2951-4b63-868a-c5a6be9c968f" class="">Answer:<div class="indented"><p id="50aabebe-a9ed-4cc8-b2e0-28e9ad9699fb" class="">No, because they each flip the other variable from 0 to 1 before being able to enter the body.</p><p id="a242b16b-be21-404d-be13-daf6b58a61ff" class="">If both variables are flipped to 1 then no body is executed → therefore this is not a good lock-algorithm.</p></div></p><p id="e5970a0d-dcdd-428e-a30d-9833b99088e8" class="">
</p><p id="39f30a86-53d4-4fea-b7dd-735ec0087c10" class="">Assuming that <mark class="highlight-gray"><code>x</code></mark>, <mark class="highlight-gray"><code>y</code></mark><mark class="highlight-gray"> </mark>are not in cache of any core:<div class="indented"><p id="19f6a785-7d27-41d3-a8d6-5d32a575cb32" class="">The answer is only valid under the assumption that the writes to the memory are not delayed - else we won’t get an interleaving of the two programs.</p></div></p><p id="14772781-c629-4af3-b79f-befb93adf1da" class="">
</p></details></li></ul></div></p><p id="ae5b92e6-6a41-46c7-932b-cddb28c69e6b" class="">
</p><p id="f1808a77-cf5f-454c-81dd-5c9a6d6841b8" class=""><mark class="highlight-blue">Sequential consistency</mark><div class="indented"><p id="8b6f60ad-10db-4e5d-931b-9f57bff674f9" class="">Outcome of parallel program = execution of some interleaving <mark class="highlight-gray">of the memory accesses of all processors</mark>.</p><p id="cf9c06f8-9a39-4dd6-a858-8286aadb383b" class="">Memory operations of each processor:<div class="indented"><ol type="1" id="33deb8ca-57eb-4576-9c98-fc9596d1f051" class="numbered-list" start="1"><li>take effect immediately</li></ol><ol type="1" id="728d00c8-2227-4400-a80f-333d0ae5da8e" class="numbered-list" start="2"><li>performed in program-order</li></ol></div></p><hr id="67259af5-e35e-46f7-9e69-3045c8ae1157"/><p id="15b46e44-5c8b-45d5-a62a-744cd07370c7" class="">Easy to prove properties of programs or reason about correctness (ie. with invariants).</p><p id="fd6acf16-305a-45d4-a610-7e575bb5e92f" class="">Is guaranteed by hardware <mark class="highlight-gray">(caches, write buffers, ... are logically transparent)</mark>.</p><ul id="275cea13-057d-4706-9fba-ca3f059d9fbb" class="toggle"><li><details open=""><summary>Sequential consistency not guaranteed by modern multiprocessors because it reduces performance.</summary><p id="1c83a06c-50cb-4f46-82af-c7382226e1e2" class="">In modern multiprocessors (ie. x86, POWER, SPARC):<div class="indented"><ul id="c744f0eb-6ab2-44a0-8a9b-9fffa204e6c7" class="bulleted-list"><li style="list-style-type:disc">Caches				may delay writes</li></ul><ul id="52b2f870-983f-47e0-b5fe-46e32188afca" class="bulleted-list"><li style="list-style-type:disc">Write buffers			may delay and/or reorder writes</li></ul><ul id="f5c06931-1dac-4701-9a8b-a4ef0993bac1" class="bulleted-list"><li style="list-style-type:disc">Memory network		may reorder writes</li></ul><ul id="3bfa30cc-a5c9-46fe-b632-d0bc81eef37c" class="bulleted-list"><li style="list-style-type:disc">Compiler 			may reorder updates</li></ul></div></p></details></li></ul></div></p><p id="e0c2bad8-fbd6-4377-9c34-5d383890611d" class="">
</p><p id="fa2a6563-b5f4-43d0-b5e1-6b7a4e341a41" class=""><mark class="highlight-blue">Relaxed consistency</mark><div class="indented"><p id="5242ee03-7b06-441b-a39d-a5f3ff63b956" class=""><mark class="highlight-gray">loads = reads, stores = writes</mark></p><p id="c8245266-e9cf-4d40-8d69-2fc39f93dbcd" class="">May permit:<div class="indented"><ul id="1ccbe882-30ea-4f58-9317-141562460be4" class="bulleted-list"><li style="list-style-type:disc">Reordering loads after loads</li></ul><ul id="a209a36c-d686-4b60-83f9-d5328fda1525" class="bulleted-list"><li style="list-style-type:disc">Reordering loads after stores</li></ul><ul id="ed1d946c-4daa-4314-b80c-4383e01b8c6c" class="bulleted-list"><li style="list-style-type:disc">Reorderung stores after loads</li></ul><ul id="c0d05988-1770-4060-9357-45504a674df7" class="bulleted-list"><li style="list-style-type:disc">Reorderung stores after stores</li></ul></div></p><hr id="6ae531d8-ba57-4388-8ad6-88342fb9281b"/><p id="60da0ff0-ed81-4e0c-819b-ed31c0022e98" class="">Weaker constraints on hardware.</p><p id="293e85f9-f0c4-4bd6-9152-cf5da99bb0f4" class="">More difficult to prove properties of programs or reason about correctness.</p><ul id="7e200766-259c-47f9-b4e2-f03f02bd1f23" class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><p id="3a3f22f3-114d-42be-b4d0-ad0ad6047b38" class="">Initial value: <mark class="highlight-gray"><code>flag = false</code></mark></p><div id="41e9d253-7b69-476f-8ba5-ba25f59e0c95" class="column-list"><div id="a5c2ae7d-7fe2-4e4a-8b25-017fb9dc1393" style="width:50%" class="column"><pre id="ced30e71-4924-4260-b2b7-73a460f70676" class="code"><code>while (!flag) { }
a = otherval;</code></pre></div><div id="904759a8-26b0-4195-8a8e-eac3f141dd04" style="width:50%" class="column"><pre id="dbe2f8e4-fa3f-4186-b212-178c6ed67360" class="code"><code>otherval = 42;
flag = true;</code></pre></div></div><p id="f219ed48-72c3-41df-bf37-9ef088e1fbdc" class="">Under sequential consistency: <div class="indented"><p id="2ccf6d67-2b3d-4c13-9d61-a0dc7e148749" class="">the outcome is <mark class="highlight-gray"><code>a == 42</code></mark></p></div></p><p id="24f7210c-e07f-491a-87df-9651b528926c" class="">Under relaxed consistency:<div class="indented"><p id="4a5a1341-6dc0-49fa-98a9-6e0db4f62ec4" class="">Writes could be reordered and <em>any</em> old value could be stored in <mark class="highlight-gray"><code>a</code></mark>.</p><p id="99630b05-19e6-4808-8a06-5b21d7badc1a" class="">Compiler won’t attempt move assignment to <mark class="highlight-gray"><code>a</code></mark> before loop but might remove the loop altogether. (Declare boolean flag as <mark class="highlight-gray"><code>volatile</code></mark>).</p></div></p><p id="ada211ee-9da2-4e2d-82d5-3afdde44ad24" class="">
</p><hr id="51cb76d0-f046-497f-b9f3-5f3b687f4cad"/><p id="a5f38860-9a90-4d56-82c8-048bf2e56a69" class="">This can be solved with a fence:  Completes all writes executed before the fence and sets flag <mark class="highlight-gray"><code>f</code></mark>.</p><div id="cf8c6fb3-50d9-44e1-ab91-a5f7edc8ebc6" class="column-list"><div id="5c108b68-89f8-4180-b912-512b2544025e" style="width:50%" class="column"><pre id="9e4e493c-14ff-47c8-8aa5-c47d48d1bfbd" class="code"><code>while (!flag) { }
fence;
a = otherval;</code></pre></div><div id="93ba744f-6f53-4311-bd86-d46158dae4ff" style="width:50%" class="column"><pre id="8810240d-681d-4f4a-8571-a90971ebe7b8" class="code"><code>otherval = 42;
fence(&amp;flag);</code></pre></div></div><p id="ee12258e-4db2-49b7-871f-c0cb9f798c10" class="">
</p></details></li></ul></div></p><p id="25a21ec8-0e0a-4962-b1ad-7c259bb1f4cd" class="">
</p><h2 id="d769c9e3-6ea6-40d4-9e68-c9816ec07803" class="">Programming models for memory</h2><p id="a4dd4d8f-2c25-421d-a1e2-4aa94b35888b" class="">Memory fences and memory barriers enforce pending operations to complete.<div class="indented"><p id="214c3736-df95-400f-a461-915b64d4d30f" class="">Fence = local operation for a core</p><p id="f190d18c-9585-4f50-afd1-201540a55269" class="">Barrier = involves all processors</p></div></p><p id="c3780b19-b550-4ac6-a20b-7573cfae5d18" class="">
</p><p id="522dacb4-99e6-44ab-a7a8-0decc627bc0a" class=""><mark class="highlight-blue">Memory fence</mark><div class="indented"><p id="17cb7943-1a33-456f-9d54-8615187e7673" class="">Programming model (memory model)</p><p id="9c1c0d48-56f9-459e-a40a-d0910f336329" class="">Synchronization/coordination construct to enforce a specific set of interleavings:<div class="indented"><p id="31dc1614-3775-4f2a-98ab-25dfe2e9d56a" class=""><mark class="highlight-gray"><code>fence;</code></mark><mark class="highlight-gray">	</mark>flushes <em>all</em> write buffers.</p></div></p><ul id="828fb629-497e-4568-aad4-30f34721b2c5" class="toggle"><li><details open=""><summary><mark class="highlight-gray">example</mark></summary><div id="b9d17778-bb3b-490a-b43a-9d73f6294e77" class="column-list"><div id="06e9330f-69ee-4be7-9293-31fd2829dea0" style="width:50%" class="column"><pre id="df0dacc5-480b-4be0-99c5-bf385e488770" class="code"><code>x = 0;
fence; // so core1 can enter
// … some code
x = 1;

fence; // so core1 can&#x27;t enter
if (y==0) {
	// body
}</code></pre></div><div id="bd4e4c48-607a-4dc9-9457-b4080b0de5e6" style="width:50%" class="column"><pre id="bf9687ad-d1a5-4c12-a840-061af22ebaf6" class="code"><code>y = 0;
fence;
// … some code
y = 1;

fence;
if (x==0) {
	// body
}</code></pre></div></div></details></li></ul></div></p><p id="898385b9-b3c7-4c02-bc8e-86faf411e9a5" class="">
</p></div></article></body></html>